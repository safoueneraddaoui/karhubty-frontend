name: Trigger Deployment Pipeline

on:
  push:
    branches:
      - main

jobs:
  trigger-devops-deployment:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deployment in devops repo
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.DEVOPS_DISPATCH_TOKEN }}
          script: |
            const eventType = 'build-and-deploy';
            const repo = {
              owner: context.repo.owner,
              repo: 'karhubty-devops'
            };
            const branch = context.ref.split('/').pop();
            
            console.log(`üöÄ Triggering deployment pipeline in karhubty-devops...`);
            console.log(`   Branch: ${branch}`);
            console.log(`   Event: ${eventType}`);
            
            try {
              await github.rest.repos.createDispatchEvent({
                owner: repo.owner,
                repo: repo.repo,
                event_type: eventType,
                client_payload: {
                  ref: branch,
                  sender: context.actor,
                  commit: context.sha,
                  message: context.payload.head_commit?.message || 'No message'
                }
              });
              
              console.log('‚úÖ Deployment pipeline triggered successfully!');
            } catch (error) {
              console.error('‚ùå Failed to trigger deployment:', error.message);
              throw error;
            }
